# Лабораторная работа: Сериализация объектов и управление файлами в C#

## 📋 Описание проекта

Проект демонстрирует работу с объектами, их сериализацией в JSON и управлением файловыми ресурсами в C#. Реализованы три основных компонента: класс `Person` для представления данных о человеке, `PersonSerializer` для сериализации/десериализации и `FileResourceManager` для безопасной работы с файлами.

## 🎯 Цели работы

1. Реализовать класс `Person` с валидацией данных и различными атрибутами сериализации
2. Создать `PersonSerializer` для работы с JSON (синхронные и асинхронные операции)
3. Разработать `FileResourceManager` для безопасного управления файловыми ресурсами
4. Организовать корректное освобождение ресурсов
5. Обеспечить потокобезопасность при работе с файлами

## 🏗️ Структура проекта

### 1. **Person.cs** - Класс для представления данных о человеке

**Особенности:**
- Свойства с разными атрибутами сериализации:
  - `[JsonIgnore]` - исключение поля из сериализации (Password)
  - `[JsonPropertyName]` - изменение имени поля в JSON
  - `[JsonInclude]` - включение приватного поля
- Валидация email (проверка наличия "@")
- Вычисляемые свойства: `FullName`, `IsAdult`
- Автоматические свойства с значениями по умолчанию

### 2. **PersonSerializer.cs** - Сериализатор объектов Person

**Функциональность:**
- Сериализация/десериализация в/из JSON
- Синхронные и асинхронные методы работы с файлами
- Поддержка работы со списками объектов
- Потокобезопасность через `ConcurrentDictionary` и локальные блокировки
- Логирование ошибок в файл `error.log`
- Читабельный JSON с отступами

**Методы:**
- `SerializeToJson()` / `DeserializeFromJson()`
- `SaveToFile()` / `LoadFromFile()`
- `SaveToFileAsync()` / `LoadFromFileAsync()`
- `SaveListToFile()` / `LoadListFromFile()`

### 3. **FileResourceManager.cs** - Менеджер файловых ресурсов

**Особенности реализации:**
- Паттерн IDisposable для корректного освобождения ресурсов
- Потокобезопасность через lock
- Поддержка различных режимов работы с файлами:
  - Чтение (`OpenForReading()`)
  - Запись (`OpenForWriting()`)
  - Добавление (`AppendText()`)
- Автоматическое создание директорий
- Обработка исключений с информативными сообщениями
- Финализатор для гарантированного освобождения ресурсов

### 4. **Program.cs** - Тестирование функциональности

**Тестовые сценарии:**
1. **Тестирование Person:**
   - Создание объекта
   - Проверка вычисляемых свойств
   - Валидация email

2. **Тестирование PersonSerializer:**
   - Сериализация в строку
   - Десериализация из строки
   - Работа с файлами (синхронно и асинхронно)
   - Работа со списками объектов

3. **Тестирование FileResourceManager:**
   - Запись и чтение файлов
   - Добавление текста
   - Получение информации о файле
   - Обработка исключений

## 🛠️ Технические особенности

### Сериализация
```csharp
// Настройки сериализатора
private readonly JsonSerializerOptions _options = new()
{
    WriteIndented = true, // Читабельный формат
};
```

### Потокобезопасность
```csharp
// Блокировки для каждого файла
private static readonly ConcurrentDictionary<string, object> _fileLocks = new();
```

### Управление ресурсами
```csharp
// Корректное освобождение ресурсов
protected virtual void Dispose(bool disposing)
{
    if (!_disposed)
    {
        if (disposing)
        {
            CloseResources();
        }
        _disposed = true;
    }
}
```

## 📊 Пример работы

### Выходные данные программы:
```
=== Тестирование Person ===
FullName: Иван Иванов
IsAdult: True
Email: ivan@example.com
Валидация email сработала: Email должен содержать @

=== Тестирование PersonSerializer ===
1. Сериализация в строку:
{
  "personId": "12345",
  "phone": "+7-999-123-45-67",
  "firstName": "Иван",
  "lastName": "Иванов",
  "age": 25,
  "email": "ivan@example.com",
  "_birthDate": "1998-05-15T00:00:00"
}

... (другие тесты)
```

## 🚀 Запуск проекта

### Требования:
- .NET 6.0 или выше
- Любая среда разработки (Visual Studio, VS Code, Rider)

### Сборка и запуск:
```bash
dotnet build
dotnet run
```

## 📝 Ключевые концепции

1. **Атрибуты сериализации** - контроль над процессом преобразования объектов
2. **IDisposable паттерн** - правильное управление неуправляемыми ресурсами
3. **Потокобезопасность** - синхронизация доступа к общим ресурсам
4. **Асинхронное программирование** - эффективная работа с I/O операциями
5. **Обработка исключений** - грамотное управление ошибками
6. **Логирование** - запись ошибок для последующего анализа

## 🔧 Возможные улучшения

1. Добавить поддержку других форматов (XML, BSON)
2. Реализовать шифрование конфиденциальных данных
3. Добавить валидацию для других полей
4. Реализовать кэширование объектов
5. Добавить поддержку сжатия файлов

## 📚 Примечания

- Проект создан в учебных целях
- Все файлы создаются в директории выполнения программы
- Автоматически создается лог-файл `error.log` при ошибках
- Тестовые файлы автоматически удаляются после выполнения тестов